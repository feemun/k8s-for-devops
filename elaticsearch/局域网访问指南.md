# Elasticsearch 8 å±€åŸŸç½‘è®¿é—®æŒ‡å—

## ğŸ¯ æ¦‚è¿°

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•åœ¨å±€åŸŸç½‘ä¸­è®¿é—®éƒ¨ç½²åœ¨ Kubernetes (Minikube) ä¸Šçš„ Elasticsearch 8 æœåŠ¡ã€‚

## ğŸ“‹ æœåŠ¡ä¿¡æ¯

- **Elasticsearch ç‰ˆæœ¬**: 8.11.0
- **å‘½åç©ºé—´**: elasticsearch
- **å®‰å…¨é…ç½®**: å·²ç¦ç”¨ (å¼€å‘ç¯å¢ƒ)
- **é›†ç¾¤æ¨¡å¼**: å•èŠ‚ç‚¹

## ğŸ”Œ ç«¯å£é…ç½®

| æœåŠ¡ç±»å‹ | å†…éƒ¨ç«¯å£ | å¤–éƒ¨ç«¯å£ | ç”¨é€” |
|---------|---------|---------|------|
| HTTP API | 9200 | 30920 | REST API è®¿é—® |
| Transport | 9300 | 30930 | é›†ç¾¤é€šä¿¡ |

## ğŸŒ è®¿é—®æ–¹å¼

### æ–¹å¼ä¸€ï¼šç›´æ¥è®¿é—® Minikube IP

```bash
# è·å– Minikube IP
minikube ip
# è¾“å‡º: 192.168.49.2

# è®¿é—® Elasticsearch
curl http://192.168.49.2:30920
curl http://192.168.49.2:30920/_cluster/health
```

### æ–¹å¼äºŒï¼šç«¯å£è½¬å‘ (æ¨è)

```bash
# å¯åŠ¨ç«¯å£è½¬å‘åˆ°æ‰€æœ‰ç½‘ç»œæ¥å£
kubectl port-forward --address 0.0.0.0 -n elasticsearch svc/elasticsearch-service 9200:9200

# å±€åŸŸç½‘è®¿é—® (æ›¿æ¢ä¸ºå®é™…çš„ä¸»æœºIP)
curl http://[ä¸»æœºIP]:9200
curl http://[ä¸»æœºIP]:9200/_cluster/health
```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬

```bash
# è¿è¡Œå¯åŠ¨è„šæœ¬
bash elaticsearch/start-elasticsearch-lan.sh
```

## ğŸ”§ å¸¸ç”¨ API æµ‹è¯•

### 1. æ£€æŸ¥é›†ç¾¤çŠ¶æ€
```bash
curl http://192.168.49.2:30920/_cluster/health?pretty
```

### 2. æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯
```bash
curl http://192.168.49.2:30920/_nodes?pretty
```

### 3. åˆ›å»ºç´¢å¼•
```bash
curl -X PUT http://192.168.49.2:30920/test-index?pretty
```

### 4. æ’å…¥æ–‡æ¡£
```bash
curl -X POST http://192.168.49.2:30920/test-index/_doc?pretty \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello Elasticsearch", "timestamp": "2024-01-01T00:00:00"}'
```

### 5. æœç´¢æ–‡æ¡£
```bash
curl http://192.168.49.2:30920/test-index/_search?pretty
```

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
kubectl get pods -n elasticsearch
kubectl get svc -n elasticsearch
```

### æŸ¥çœ‹æ—¥å¿—
```bash
kubectl logs -n elasticsearch deployment/elasticsearch
```

### è¿›å…¥å®¹å™¨
```bash
kubectl exec -it -n elasticsearch deployment/elasticsearch -- bash
```

### åˆ é™¤æœåŠ¡
```bash
kubectl delete -f elaticsearch/elasticsearch-deploy.yaml
```

## ğŸ” æ•…éšœæ’é™¤

### Pod å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯
kubectl describe pod -n elasticsearch

# æŸ¥çœ‹ Pod æ—¥å¿—
kubectl logs -n elasticsearch [pod-name]
```

### æ— æ³•è®¿é—®æœåŠ¡
1. æ£€æŸ¥ Pod æ˜¯å¦è¿è¡Œæ­£å¸¸
2. ç¡®è®¤é˜²ç«å¢™è®¾ç½®
3. éªŒè¯ç½‘ç»œè¿æ¥
4. æ£€æŸ¥ç«¯å£è½¬å‘çŠ¶æ€

### å†…å­˜ä¸è¶³
- Elasticsearch é»˜è®¤é…ç½®éœ€è¦è‡³å°‘ 2GB å†…å­˜
- å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è°ƒæ•´ `ES_JAVA_OPTS` å‚æ•°

## ğŸ“Š æ€§èƒ½ç›‘æ§

### é›†ç¾¤å¥åº·çŠ¶æ€
- **Green**: æ‰€æœ‰åˆ†ç‰‡æ­£å¸¸
- **Yellow**: ä¸»åˆ†ç‰‡æ­£å¸¸ï¼Œå‰¯æœ¬åˆ†ç‰‡å¼‚å¸¸
- **Red**: éƒ¨åˆ†ä¸»åˆ†ç‰‡å¼‚å¸¸

### èµ„æºä½¿ç”¨æƒ…å†µ
```bash
curl http://192.168.49.2:30920/_nodes/stats?pretty
```

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦**: å½“å‰é…ç½®å·²ç¦ç”¨å®‰å…¨åŠŸèƒ½ï¼Œä»…é€‚ç”¨äºå¼€å‘ç¯å¢ƒã€‚

ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š
1. å¯ç”¨ X-Pack å®‰å…¨åŠŸèƒ½
2. é…ç½® SSL/TLS åŠ å¯†
3. è®¾ç½®ç”¨æˆ·è®¤è¯å’Œæˆæƒ
4. é™åˆ¶ç½‘ç»œè®¿é—®

## ğŸ“š ç›¸å…³èµ„æº

- [Elasticsearch å®˜æ–¹æ–‡æ¡£](https://www.elastic.co/guide/en/elasticsearch/reference/8.11/index.html)
- [Kubernetes å®˜æ–¹æ–‡æ¡£](https://kubernetes.io/docs/)
- [Minikube å®˜æ–¹æ–‡æ¡£](https://minikube.sigs.k8s.io/docs/)